<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de Recordatorio - Hubdox Chat SDK</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        .feature {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid #007bff;
        }
        .feature h3 {
            color: #007bff;
            margin-top: 0;
        }
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 15px 0;
        }
        .controls {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        .btn {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .btn:hover {
            background: #0056b3;
        }
        .btn-success {
            background: #28a745;
        }
        .btn-success:hover {
            background: #218838;
        }
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        .btn-warning:hover {
            background: #e0a800;
        }
        .btn-danger {
            background: #dc3545;
        }
        .btn-danger:hover {
            background: #c82333;
        }
        .info-box {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 4px solid #2196f3;
        }
        .warning-box {
            background: #fff3cd;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 4px solid #ffc107;
        }
        .status-display {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚è∞ Test de Recordatorio</h1>
        
        <div class="feature">
            <h3>üîÑ Sistema de Recordatorio Autom√°tico</h3>
            <p>El chat ahora incluye un sistema de recordatorio que pregunta al usuario si no ha escrito nada en un tiempo determinado.</p>
        </div>

        <div class="info-box">
            <h4>üìã Caracter√≠sticas del Recordatorio</h4>
            <ul>
                <li><strong>Tiempo configurable:</strong> Por defecto 60 segundos (1 minuto)</li>
                <li><strong>Mensaje autom√°tico:</strong> "¬øHay algo m√°s en lo que pueda ayudarte? üòä"</li>
                <li><strong>Con sonido:</strong> Reproduce notificaci√≥n cuando se muestra el recordatorio</li>
                <li><strong>Inteligente:</strong> Solo funciona cuando el chat est√° abierto y no en pantalla de registro</li>
                <li><strong>Espera respuesta completa:</strong> El temporizador inicia solo despu√©s de que el bot termine de responder</li>
                <li><strong>Compatible con streaming:</strong> Espera a que termine el efecto de typing antes de iniciar</li>
                <li><strong>Se reinicia:</strong> El temporizador se reinicia cada vez que el usuario escribe</li>
                <li><strong>Persistente:</strong> El estado se guarda en cach√©</li>
            </ul>
        </div>

        <div class="warning-box">
            <h4>‚ö†Ô∏è Importante</h4>
            <p>El recordatorio solo funciona cuando el chat est√° abierto y visible. Se pausa autom√°ticamente cuando se cierra el chat.</p>
        </div>

        <div class="feature">
            <h3>üîß Configuraci√≥n</h3>
            <div class="code-block">
const chat = new ChatBot({
  // ... configuraci√≥n b√°sica
  custom: {
    // ... otras opciones
    reminderTimeout: 30000,  // 30 segundos
    // reminderTimeout: 60000,  // 60 segundos (por defecto)
    // reminderTimeout: 120000, // 2 minutos
  }
});
            </div>
        </div>

        <div class="controls">
            <h3>üéÆ Controles de Prueba</h3>
            <button class="btn" onclick="initChatWithReminder()">‚è∞ Chat con Recordatorio</button>
            <button class="btn btn-warning" onclick="setShortTimeout()">‚ö° Recordatorio R√°pido (10s)</button>
            <button class="btn btn-success" onclick="setLongTimeout()">üêå Recordatorio Lento (2min)</button>
            <button class="btn btn-danger" onclick="disableReminder()">üö´ Deshabilitar Recordatorio</button>
            <button class="btn" onclick="showStatus()">üìä Ver Estado</button>
            <button class="btn" onclick="clearCache()">üóëÔ∏è Limpiar Cach√©</button>
        </div>

        <div class="status-display" id="status">
            Estado: Inicializando...
        </div>

        <div class="feature">
            <h3>üîç C√≥mo Probar</h3>
            <ol>
                <li>Haz clic en "Chat con Recordatorio" para inicializar</li>
                <li>Abre el chat y env√≠a un mensaje</li>
                <li>Espera a que el bot termine de responder completamente</li>
                <li>Despu√©s de 60 segundos sin escribir nada, aparecer√° el recordatorio con sonido</li>
                <li>Con streaming activado, el temporizador espera a que termine el efecto de typing</li>
                <li>Prueba diferentes tiempos con los botones de configuraci√≥n</li>
                <li>Usa "Ver Estado" para monitorear el temporizador</li>
            </ol>
        </div>

        <div class="feature">
            <h3>‚öôÔ∏è M√©todos P√∫blicos</h3>
            <div class="code-block">
// Configurar tiempo de recordatorio
chat.setReminderTimeout(30000); // 30 segundos

// Obtener estado del recordatorio
const status = chat.getReminderStatus();
console.log(status);
// {
//   reminderTimeout: 30000,
//   lastUserMessageTime: 1234567890,
//   hasActiveTimer: true,
//   timeSinceLastMessage: 45000
// }
            </div>
        </div>

        <!-- Chat Bot -->
        <script src="../src/index.js"></script>
        <script>
            let chat;

            function initChatWithReminder() {
                if (chat) {
                    chat.destroy();
                }
                
                chat = new ChatBot({
                  baseUrl: 'https://hubdocs.test',
                  apiKey: 'Ae812043-87ed-4bde-ba4a-0daaff8aadad',
                  tenant: 'nomed',
                  bot: { 
                      name: 'Boti', 
                      img: "../src/img/bot_icon.png"  
                  },
                    options: {
                        show: true,
                        register: false,
                        cache: true,
                        testMode: true,
                        stream: true,
                        devMode: false,
                    },
                    custom: {
                        primaryColor: "#007bff",
                        botName: "Bot de Test",
                        headerBgColor: "#007bff",
                        headerTextColor: "#fff",
                        showTime: true,
                        sound: true, // Habilitar sonido para recordatorios
                        reminderTimeout: 60000, // 60 segundos por defecto
                        position: {
                            bottom: "24px",
                            right: "24px"
                        }
                    }
                });
                
                console.log('‚úÖ Chat inicializado con recordatorio (60s) y sonido');
                updateStatus();
                alert('Chat inicializado con recordatorio de 60 segundos y sonido habilitado. Abre el chat y env√≠a un mensaje, luego espera 1 minuto para escuchar la notificaci√≥n.');
            }

            function setShortTimeout() {
                if (chat) {
                    chat.setReminderTimeout(10000); // 10 segundos
                    console.log('‚ö° Recordatorio configurado a 10 segundos');
                    updateStatus();
                    alert('Recordatorio configurado a 10 segundos. Env√≠a un mensaje y espera 10 segundos.');
                } else {
                    alert('Primero inicializa un chat');
                }
            }

            function setLongTimeout() {
                if (chat) {
                    chat.setReminderTimeout(120000); // 2 minutos
                    console.log('üêå Recordatorio configurado a 2 minutos');
                    updateStatus();
                    alert('Recordatorio configurado a 2 minutos. Env√≠a un mensaje y espera 2 minutos.');
                } else {
                    alert('Primero inicializa un chat');
                }
            }

            function disableReminder() {
                if (chat) {
                    chat.setReminderTimeout(0); // Deshabilitar
                    console.log('üö´ Recordatorio deshabilitado');
                    updateStatus();
                    alert('Recordatorio deshabilitado. No se mostrar√°n mensajes autom√°ticos.');
                } else {
                    alert('Primero inicializa un chat');
                }
            }

            function showStatus() {
                if (chat) {
                    const status = chat.getReminderStatus();
                    const timeSince = status.timeSinceLastMessage ? Math.round(status.timeSinceLastMessage / 1000) : 'N/A';
                    
                    const statusText = `Estado del Recordatorio:
Tiempo configurado: ${status.reminderTimeout / 1000}s
Temporizador activo: ${status.hasActiveTimer ? 'S√≠' : 'No'}
√öltimo mensaje: ${status.lastUserMessageTime ? new Date(status.lastUserMessageTime).toLocaleTimeString() : 'N/A'}
Tiempo transcurrido: ${timeSince}s
Chat visible: ${chat.chatVisible ? 'S√≠' : 'No'}
Pantalla de registro: ${chat.registrationScreen ? 'S√≠' : 'No'}`;
                    
                    alert(statusText);
                    console.log('üìä Estado del recordatorio:', status);
                } else {
                    alert('Primero inicializa un chat');
                }
            }

            function clearCache() {
                if (chat) {
                    chat.clearCache();
                    console.log('üóëÔ∏è Cach√© limpiado');
                    updateStatus();
                    alert('Cach√© limpiado. El recordatorio se reiniciar√°.');
                } else {
                    alert('Primero inicializa un chat');
                }
            }

            function updateStatus() {
                if (chat) {
                    const status = chat.getReminderStatus();
                    const timeSince = status.timeSinceLastMessage ? Math.round(status.timeSinceLastMessage / 1000) : 'N/A';
                    
                    document.getElementById('status').innerHTML = `
<strong>Estado Actual:</strong><br>
‚è∞ Tiempo configurado: ${status.reminderTimeout / 1000}s<br>
üîÑ Temporizador activo: ${status.hasActiveTimer ? '‚úÖ S√≠' : '‚ùå No'}<br>
üìù √öltimo mensaje: ${status.lastUserMessageTime ? new Date(status.lastUserMessageTime).toLocaleTimeString() : 'N/A'}<br>
‚è±Ô∏è Tiempo transcurrido: ${timeSince}s<br>
üëÅÔ∏è Chat visible: ${chat.chatVisible ? '‚úÖ S√≠' : '‚ùå No'}<br>
üìù Pantalla de registro: ${chat.registrationScreen ? '‚úÖ S√≠' : '‚ùå No'}
                    `;
                } else {
                    document.getElementById('status').innerHTML = 'Estado: Chat no inicializado';
                }
            }

            // Actualizar estado cada 5 segundos
            setInterval(updateStatus, 1000);

            // Inicializar chat por defecto
            window.addEventListener('load', () => {
                initChatWithReminder();
            });
        </script>
    </div>
</body>
</html> 